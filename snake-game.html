<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="8-bitå¤å¤è´ªåƒè›‡æ¸¸æˆ - wyjçš„ä¸ªäººç½‘ç«™">
    <title>ğŸ è´ªåƒè›‡æ¸¸æˆ - wyjçš„ä¸ªäººç½‘ç«™</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* æ¸¸æˆé¡µé¢ä¸“ç”¨æ ·å¼ */
        .game-page {
            min-height: 100vh;
            background: linear-gradient(45deg, #1a1a2e, #16213e, #0f3460);
            color: #00ff41;
            font-family: 'Courier New', 'Monaco', 'Lucida Console', monospace;
            overflow-x: hidden; /* åªéšè—æ¨ªå‘æ»šåŠ¨æ¡ */
            overflow-y: auto;   /* å…è®¸çºµå‘æ»šåŠ¨ */
        }

        /* éšè—ä¸»é¢˜åˆ‡æ¢æŒ‰é’® */
        .game-page .theme-toggle {
            display: none !important;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            padding: 2rem;
            text-align: center;
            box-sizing: border-box;
        }

        .game-title {
            font-size: 3rem;
            color: #ff6b6b;
            text-shadow: 2px 2px 0px #000, 0 0 30px #ff6b6b;
            margin-bottom: 1rem;
            animation: title-glow 2s ease-in-out infinite alternate;
        }

        @keyframes title-glow {
            0% { text-shadow: 2px 2px 0px #000, 0 0 30px #ff6b6b; }
            100% { text-shadow: 2px 2px 0px #000, 0 0 50px #ff6b6b, 0 0 70px #ff6b6b; }
        }

        .game-subtitle {
            font-size: 1.2rem;
            color: #4ecdc4;
            text-shadow: 1px 1px 0px #000, 0 0 15px #4ecdc4;
            margin-bottom: 2rem;
        }

        .game-canvas-container {
            position: relative;
            background: rgba(0, 0, 0, 0.8);
            border: 4px solid #00ff41;
            border-radius: 10px;
            padding: 1rem;
            box-shadow: 0 0 30px rgba(0, 255, 65, 0.5);
            margin-bottom: 2rem;
        }

        #gameCanvas {
            border: 2px solid #4ecdc4;
            background: #000;
            display: block;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 520px;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .score-display {
            color: #ff6b6b;
            text-shadow: 1px 1px 0px #000, 0 0 10px #ff6b6b;
        }

        .level-display {
            color: #4ecdc4;
            text-shadow: 1px 1px 0px #000, 0 0 10px #4ecdc4;
        }

        .high-score-display {
            color: #00ff41;
            text-shadow: 1px 1px 0px #000, 0 0 10px #00ff41;
        }

        .game-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            max-width: 200px;
            margin-bottom: 2rem;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.8);
            color: #4ecdc4;
            border: 2px solid #4ecdc4;
            padding: 0.8rem;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 1px 1px 0px #000;
        }

        .control-btn:hover {
            background: #4ecdc4;
            color: #000;
            text-shadow: none;
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.6);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .control-btn.empty {
            visibility: hidden;
        }

        .game-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 2rem;
        }

        .game-btn {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border: 2px solid #00ff41;
            padding: 0.8rem 1.5rem;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            text-transform: uppercase;
            text-shadow: 1px 1px 0px #000;
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.5);
            transition: all 0.3s ease;
        }

        .game-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(0, 255, 65, 0.8);
        }

        .game-btn:active {
            transform: scale(0.95);
        }

        .game-instructions {
            max-width: 600px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00ff41;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .game-instructions h3 {
            color: #ff6b6b;
            text-shadow: 1px 1px 0px #000, 0 0 15px #ff6b6b;
            margin-bottom: 1rem;
        }

        .game-instructions p {
            color: #e0e0e0;
            text-shadow: 1px 1px 0px #000;
            margin-bottom: 0.8rem;
        }

        .game-instructions kbd {
            background: rgba(78, 205, 196, 0.2);
            color: #4ecdc4;
            border: 1px solid #4ecdc4;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        .back-to-site {
            position: fixed;
            top: 20px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: #4ecdc4;
            border: 2px solid #4ecdc4;
            padding: 0.8rem 1.2rem;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            text-decoration: none;
            transition: all 0.3s ease;
            text-shadow: 1px 1px 0px #000;
            z-index: 1000;
        }

        .back-to-site:hover {
            background: #4ecdc4;
            color: #000;
            text-shadow: none;
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.6);
        }

        .game-over-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-content {
            background: rgba(0, 0, 0, 0.95);
            border: 4px solid #ff6b6b;
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 0 50px rgba(255, 107, 107, 0.7);
            animation: modal-appear 0.5s ease-out;
        }

        @keyframes modal-appear {
            0% {
                opacity: 0;
                transform: scale(0.7);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-title {
            font-size: 2rem;
            color: #ff6b6b;
            text-shadow: 2px 2px 0px #000, 0 0 30px #ff6b6b;
            margin-bottom: 1rem;
        }

        .modal-score {
            font-size: 1.3rem;
            color: #00ff41;
            text-shadow: 1px 1px 0px #000, 0 0 15px #00ff41;
            margin-bottom: 2rem;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .game-title {
                font-size: 2rem;
                margin-top: 1rem;
            }
            
            .game-container {
                padding: 1rem;
                padding-top: 4rem; /* ä¸ºè¿”å›æŒ‰é’®ç•™å‡ºç©ºé—´ */
                justify-content: flex-start;
            }
            
            #gameCanvas {
                width: 300px;
                height: 300px;
            }
            
            .back-to-site {
                top: 10px;
                left: 5px;
                padding: 0.6rem 0.8rem;
                font-size: 0.9rem;
            }

            .game-instructions {
                font-size: 0.9rem;
                max-width: 90%;
            }

            .game-controls {
                max-width: 150px;
                gap: 0.3rem;
            }

            .control-btn {
                padding: 0.6rem;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            .game-container {
                padding: 0.5rem;
                padding-top: 3.5rem;
            }

            .game-title {
                font-size: 1.8rem;
            }

            .game-subtitle {
                font-size: 1rem;
            }

            #gameCanvas {
                width: 280px;
                height: 280px;
            }

            .game-instructions {
                font-size: 0.8rem;
                padding: 1rem;
            }
        }

        /* åƒç´ é›¨èƒŒæ™¯åŠ¨ç”» */
        .pixel-rain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 2px,
                    #00ff41 2px,
                    #00ff41 4px
                ),
                repeating-linear-gradient(
                    transparent,
                    transparent 2px,
                    #00ff41 2px,
                    #00ff41 4px
                );
            opacity: 0.05;
            animation: pixel-rain-fall 20s linear infinite;
            z-index: -1;
            pointer-events: none;
        }

        @keyframes pixel-rain-fall {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100vh); }
        }
    </style>
</head>
<body class="game-page">
    <div class="pixel-rain"></div>
    
    <a href="index.html" class="back-to-site">ğŸ  è¿”å›ç½‘ç«™</a>

    <div class="game-container">
        <h1 class="game-title">ğŸ è´ªåƒè›‡</h1>
        <p class="game-subtitle">ç»å…¸8-bitå¤å¤æ¸¸æˆä½“éªŒ</p>

        <div class="game-info">
            <div class="score-display">åˆ†æ•°: <span id="score">0</span></div>
            <div class="level-display">ç­‰çº§: <span id="level">1</span></div>
            <div class="high-score-display">æœ€é«˜åˆ†: <span id="highScore">0</span></div>
        </div>

        <div class="game-status" id="gameStatus" style="
            text-align: center;
            font-size: 1.1rem;
            color: #4ecdc4;
            text-shadow: 1px 1px 0px #000, 0 0 15px #4ecdc4;
            margin-bottom: 1rem;
            font-weight: bold;
        ">
            ğŸ® æŒ‰æ–¹å‘é”®æˆ–ç‚¹å‡»æŒ‰é’®å¼€å§‹æ¸¸æˆï¼
        </div>

        <div class="game-canvas-container">
            <canvas id="gameCanvas" width="400" height="400"></canvas>
        </div>

        <div class="game-controls">
            <div class="control-btn empty"></div>
            <div class="control-btn" onclick="changeDirection('up')">â†‘</div>
            <div class="control-btn empty"></div>
            <div class="control-btn" onclick="changeDirection('left')">â†</div>
            <div class="control-btn" onclick="changeDirection('down')">â†“</div>
            <div class="control-btn" onclick="changeDirection('right')">â†’</div>
        </div>

        <div class="game-buttons">
            <button class="game-btn" onclick="startGame()">ğŸ® å¼€å§‹æ¸¸æˆ</button>
            <button class="game-btn" onclick="pauseGame()">â¸ï¸ æš‚åœ</button>
            <button class="game-btn" onclick="resetGame()">ğŸ”„ é‡æ–°å¼€å§‹</button>
        </div>

        <div class="game-instructions">
            <h3>ğŸ¯ æ¸¸æˆè¯´æ˜</h3>
            <p>ğŸ æ§åˆ¶è›‡åƒæ‰é£Ÿç‰©ï¼Œè®©è›‡å˜å¾—æ›´é•¿</p>
            <p>ğŸ¯ æ¯åƒæ‰ä¸€ä¸ªé£Ÿç‰©å¾—10åˆ†ï¼Œé€Ÿåº¦ä¼šé€æ¸åŠ å¿«</p>
            <p>âš ï¸ ä¸è¦æ’åˆ°å¢™å£æˆ–è‡ªå·±çš„èº«ä½“</p>
            <p>ğŸ® ä½¿ç”¨ <kbd>â†‘</kbd> <kbd>â†“</kbd> <kbd>â†</kbd> <kbd>â†’</kbd> æ–¹å‘é”®æˆ–æŒ‰é’®æ§åˆ¶</p>
            <p>ğŸ† æŒ‘æˆ˜æ›´é«˜åˆ†æ•°ï¼Œæˆä¸ºè´ªåƒè›‡å¤§å¸ˆï¼</p>
        </div>
    </div>

    <!-- æ¸¸æˆç»“æŸæ¨¡æ€æ¡† -->
    <div class="game-over-modal" id="gameOverModal">
        <div class="modal-content">
            <h2 class="modal-title">ğŸ® æ¸¸æˆç»“æŸ</h2>
            <div class="modal-score">
                <p>æœ¬æ¬¡åˆ†æ•°: <span id="finalScore">0</span></p>
                <p id="newHighScore" style="display: none; color: #ff6b6b;">ğŸ† æ–°çºªå½•ï¼</p>
            </div>
            <div class="game-buttons">
                <button class="game-btn" onclick="restartGame()">ğŸ”„ å†æ¥ä¸€å±€</button>
                <button class="game-btn" onclick="closeGameOver()">âŒ å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            canvas: null,
            ctx: null,
            snake: [{x: 200, y: 200}],
            direction: {x: 0, y: 0},
            food: {x: 0, y: 0},
            score: 0,
            level: 1,
            highScore: 0,
            gameRunning: false,
            gameLoop: null,
            gridSize: 20,
            gameSpeed: 200
        };

        // éŸ³æ•ˆç³»ç»Ÿ
        class GameAudio {
            constructor() {
                this.audioContext = null;
                this.init();
            }

            init() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (error) {
                    console.log('éŸ³é¢‘ä¸Šä¸‹æ–‡åˆ›å»ºå¤±è´¥ï¼Œä½†ä¸å½±å“æ¸¸æˆ:', error);
                }
            }

            playSound(frequency, duration, type = 'square') {
                if (!this.audioContext) return;
                
                try {
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                    oscillator.type = type;
                    
                    gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);
                    
                    oscillator.start(this.audioContext.currentTime);
                    oscillator.stop(this.audioContext.currentTime + duration);
                } catch (error) {
                    console.log('éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', error);
                }
            }

            playEat() {
                this.playSound(523, 0.1); // C5
                setTimeout(() => this.playSound(659, 0.1), 50); // E5
            }

            playGameOver() {
                const notes = [523, 440, 349, 293]; // C5, A4, F4, D4
                notes.forEach((note, index) => {
                    setTimeout(() => this.playSound(note, 0.3), index * 100);
                });
            }

            playLevelUp() {
                const notes = [262, 330, 392, 523]; // C4, E4, G4, C5
                notes.forEach((note, index) => {
                    setTimeout(() => this.playSound(note, 0.2), index * 100);
                });
            }
        }

        // åˆå§‹åŒ–éŸ³æ•ˆ
        const gameAudio = new GameAudio();

        // æ¸¸æˆåˆå§‹åŒ–
        function initGame() {
            gameState.canvas = document.getElementById('gameCanvas');
            gameState.ctx = gameState.canvas.getContext('2d');
            
            // åŠ è½½æœ€é«˜åˆ†
            gameState.highScore = parseInt(localStorage.getItem('snakeHighScore') || '0');
            updateDisplay();
            
            // ç”Ÿæˆåˆå§‹é£Ÿç‰©
            generateFood();
            
            // ç»˜åˆ¶åˆå§‹çŠ¶æ€
            draw();
            
            console.log('ğŸ è´ªåƒè›‡æ¸¸æˆåˆå§‹åŒ–å®Œæˆï¼');
        }

        // ç”Ÿæˆé£Ÿç‰©
        function generateFood() {
            const maxX = (gameState.canvas.width - gameState.gridSize) / gameState.gridSize;
            const maxY = (gameState.canvas.height - gameState.gridSize) / gameState.gridSize;
            
            do {
                gameState.food.x = Math.floor(Math.random() * maxX) * gameState.gridSize;
                gameState.food.y = Math.floor(Math.random() * maxY) * gameState.gridSize;
            } while (isSnakePosition(gameState.food.x, gameState.food.y));
        }

        // æ£€æŸ¥æ˜¯å¦æ˜¯è›‡çš„ä½ç½®
        function isSnakePosition(x, y) {
            return gameState.snake.some(segment => segment.x === x && segment.y === y);
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('highScore').textContent = gameState.highScore;
        }

        // æ›´æ–°æ¸¸æˆçŠ¶æ€æç¤º
        function updateGameStatus(message) {
            const statusElement = document.getElementById('gameStatus');
            if (statusElement) {
                statusElement.textContent = message;
            }
        }

        // ç»˜åˆ¶æ¸¸æˆ
        function draw() {
            const ctx = gameState.ctx;
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, gameState.canvas.width, gameState.canvas.height);
            
            // ç»˜åˆ¶ç½‘æ ¼èƒŒæ™¯
            ctx.strokeStyle = '#1a1a2e';
            ctx.lineWidth = 1;
            for (let x = 0; x < gameState.canvas.width; x += gameState.gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, gameState.canvas.height);
                ctx.stroke();
            }
            for (let y = 0; y < gameState.canvas.height; y += gameState.gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(gameState.canvas.width, y);
                ctx.stroke();
            }
            
            // ç»˜åˆ¶è›‡
            gameState.snake.forEach((segment, index) => {
                if (index === 0) {
                    // è›‡å¤´ - å¸¦å‘å…‰æ•ˆæœ
                    ctx.fillStyle = '#00ff41';
                    ctx.shadowColor = '#00ff41';
                    ctx.shadowBlur = 10;
                } else {
                    // è›‡èº«
                    ctx.fillStyle = '#4ecdc4';
                    ctx.shadowBlur = 5;
                }
                
                ctx.fillRect(segment.x, segment.y, gameState.gridSize - 2, gameState.gridSize - 2);
                
                // æ·»åŠ è¾¹æ¡†
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 1;
                ctx.strokeRect(segment.x, segment.y, gameState.gridSize - 2, gameState.gridSize - 2);
            });
            
            // ç»˜åˆ¶é£Ÿç‰© - å¸¦é—ªçƒæ•ˆæœ
            ctx.shadowColor = '#ff6b6b';
            ctx.shadowBlur = 15;
            ctx.fillStyle = '#ff6b6b';
            ctx.fillRect(gameState.food.x, gameState.food.y, gameState.gridSize - 2, gameState.gridSize - 2);
            
            // é£Ÿç‰©è¾¹æ¡†
            ctx.strokeStyle = '#fff';
            ctx.strokeRect(gameState.food.x, gameState.food.y, gameState.gridSize - 2, gameState.gridSize - 2);
            
            // é‡ç½®é˜´å½±
            ctx.shadowBlur = 0;
        }

        // æ¸¸æˆä¸»å¾ªç¯
        function gameLoop() {
            if (!gameState.gameRunning) return;
            
            // ç§»åŠ¨è›‡
            const head = {
                x: gameState.snake[0].x + gameState.direction.x * gameState.gridSize,
                y: gameState.snake[0].y + gameState.direction.y * gameState.gridSize
            };
            
            // æ£€æŸ¥ç¢°æ’
            if (checkCollision(head)) {
                gameOver();
                return;
            }
            
            gameState.snake.unshift(head);
            
            // æ£€æŸ¥æ˜¯å¦åƒåˆ°é£Ÿç‰©
            if (head.x === gameState.food.x && head.y === gameState.food.y) {
                gameState.score += 10;
                gameAudio.playEat();
                
                // å‡çº§é€»è¾‘
                const newLevel = Math.floor(gameState.score / 100) + 1;
                if (newLevel > gameState.level) {
                    gameState.level = newLevel;
                    gameState.gameSpeed = Math.max(50, gameState.gameSpeed - 20);
                    gameAudio.playLevelUp();
                    
                    // é‡å¯æ¸¸æˆå¾ªç¯ä»¥åº”ç”¨æ–°é€Ÿåº¦
                    clearInterval(gameState.gameLoop);
                    gameState.gameLoop = setInterval(gameLoop, gameState.gameSpeed);
                }
                
                generateFood();
                updateDisplay();
            } else {
                gameState.snake.pop();
            }
            
            draw();
        }

        // æ£€æŸ¥ç¢°æ’
        function checkCollision(head) {
            // æ£€æŸ¥å¢™å£ç¢°æ’
            if (head.x < 0 || head.x >= gameState.canvas.width || 
                head.y < 0 || head.y >= gameState.canvas.height) {
                return true;
            }
            
            // æ£€æŸ¥è‡ªèº«ç¢°æ’
            return gameState.snake.some(segment => segment.x === head.x && segment.y === head.y);
        }

        // æ”¹å˜æ–¹å‘
        function changeDirection(newDirection) {
            // å¦‚æœæ¸¸æˆè¿˜æ²¡å¼€å§‹ï¼Œè‡ªåŠ¨å¼€å§‹æ¸¸æˆ
            if (!gameState.gameRunning && gameState.snake.length === 1) {
                startGame();
            }
            
            // å¦‚æœæ¸¸æˆæœªè¿è¡Œï¼ˆæš‚åœçŠ¶æ€ï¼‰ï¼Œåˆ™ä¸å…è®¸æ”¹å˜æ–¹å‘
            if (!gameState.gameRunning) return;
            
            const directions = {
                'up': {x: 0, y: -1},
                'down': {x: 0, y: 1},
                'left': {x: -1, y: 0},
                'right': {x: 1, y: 0}
            };
            
            const newDir = directions[newDirection];
            
            // é˜²æ­¢è›‡åå‘ç§»åŠ¨
            if (newDir.x === -gameState.direction.x && newDir.y === -gameState.direction.y) {
                return;
            }
            
            gameState.direction = newDir;
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            if (gameState.gameRunning) return;
            
            gameState.gameRunning = true;
            // å¦‚æœæ–¹å‘è¿˜æ²¡è®¾ç½®ï¼Œé»˜è®¤å‘å³
            if (gameState.direction.x === 0 && gameState.direction.y === 0) {
                gameState.direction = {x: 1, y: 0};
            }
            gameState.gameLoop = setInterval(gameLoop, gameState.gameSpeed);
            
            updateGameStatus('ğŸ æ¸¸æˆè¿›è¡Œä¸­... ä½¿ç”¨æ–¹å‘é”®æ§åˆ¶è›‡çš„ç§»åŠ¨ï¼');
            console.log('ğŸ® æ¸¸æˆå¼€å§‹ï¼');
        }

        // æš‚åœæ¸¸æˆ
        function pauseGame() {
            if (gameState.gameRunning) {
                gameState.gameRunning = false;
                clearInterval(gameState.gameLoop);
                updateGameStatus('â¸ï¸ æ¸¸æˆå·²æš‚åœï¼Œç‚¹å‡»ç»§ç»­æˆ–æŒ‰ç©ºæ ¼é”®æ¢å¤');
                console.log('â¸ï¸ æ¸¸æˆæš‚åœ');
            } else {
                startGame();
                console.log('â–¶ï¸ æ¸¸æˆç»§ç»­');
            }
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            gameState.gameRunning = false;
            clearInterval(gameState.gameLoop);
            
            gameState.snake = [{x: 200, y: 200}];
            gameState.direction = {x: 0, y: 0};
            gameState.score = 0;
            gameState.level = 1;
            gameState.gameSpeed = 200;
            
            generateFood();
            updateDisplay();
            draw();
            
            updateGameStatus('ğŸ® æŒ‰æ–¹å‘é”®æˆ–ç‚¹å‡»æŒ‰é’®å¼€å§‹æ¸¸æˆï¼');
            console.log('ğŸ”„ æ¸¸æˆé‡ç½®');
        }

        // æ¸¸æˆç»“æŸ
        function gameOver() {
            gameState.gameRunning = false;
            clearInterval(gameState.gameLoop);
            
            updateGameStatus('ğŸ’€ æ¸¸æˆç»“æŸï¼ç‚¹å‡»é‡æ–°å¼€å§‹æŒ‰é’®å†æ¥ä¸€å±€');
            gameAudio.playGameOver();
            
            // æ£€æŸ¥æ˜¯å¦åˆ›é€ æ–°çºªå½•
            let isNewHighScore = false;
            if (gameState.score > gameState.highScore) {
                gameState.highScore = gameState.score;
                localStorage.setItem('snakeHighScore', gameState.highScore.toString());
                isNewHighScore = true;
            }
            
            // æ˜¾ç¤ºæ¸¸æˆç»“æŸæ¨¡æ€æ¡†
            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('newHighScore').style.display = isNewHighScore ? 'block' : 'none';
            document.getElementById('gameOverModal').style.display = 'flex';
            
            updateDisplay();
            console.log('ğŸ’€ æ¸¸æˆç»“æŸï¼åˆ†æ•°:', gameState.score);
        }

        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            closeGameOver();
            resetGame();
            startGame();
        }

        // å…³é—­æ¸¸æˆç»“æŸæ¨¡æ€æ¡†
        function closeGameOver() {
            document.getElementById('gameOverModal').style.display = 'none';
        }

        // é”®ç›˜äº‹ä»¶ç›‘å¬
        document.addEventListener('keydown', function(event) {
            const key = event.key.toLowerCase();
            
            switch(key) {
                case 'arrowup':
                case 'w':
                    event.preventDefault();
                    changeDirection('up');
                    break;
                case 'arrowdown':
                case 's':
                    event.preventDefault();
                    changeDirection('down');
                    break;
                case 'arrowleft':
                case 'a':
                    event.preventDefault();
                    changeDirection('left');
                    break;
                case 'arrowright':
                case 'd':
                    event.preventDefault();
                    changeDirection('right');
                    break;
                case ' ':
                    event.preventDefault();
                    pauseGame();
                    break;
                case 'enter':
                    event.preventDefault();
                    if (!gameState.gameRunning && gameState.snake.length === 1) {
                        startGame();
                    }
                    break;
            }
        });

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', function() {
            initGame();
            console.log('ğŸ è´ªåƒè›‡æ¸¸æˆé¡µé¢åŠ è½½å®Œæˆï¼');
        });

        // é˜²æ­¢é¡µé¢åˆ·æ–°æ—¶æ„å¤–é€€å‡º
        window.addEventListener('beforeunload', function(event) {
            if (gameState.gameRunning) {
                event.preventDefault();
                event.returnValue = 'æ¸¸æˆæ­£åœ¨è¿›è¡Œä¸­ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ';
                return event.returnValue;
            }
        });
    </script>
</body>
</html>
